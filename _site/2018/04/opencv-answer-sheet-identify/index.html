<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>åŸºäº OpenCV çš„ iOS å®¢æˆ·ç«¯ç­”é¢˜å¡è¯†åˆ«ç®—æ³•</title>
  <meta name="description" content="æœ€è¿‘è®¡åˆ’å­¦ä¹ ä¸€äº›å›¾åƒå¤„ç†æ–¹é¢çš„çŸ¥è¯†ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°äº†åŠŸèƒ½å¼ºå¤§çš„ OpenCV Libã€‚">
  <meta name="author" content="å´”é¹é£">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="åŸºäº OpenCV çš„ iOS å®¢æˆ·ç«¯ç­”é¢˜å¡è¯†åˆ«ç®—æ³•">
  <meta name="twitter:description" content="æœ€è¿‘è®¡åˆ’å­¦ä¹ ä¸€äº›å›¾åƒå¤„ç†æ–¹é¢çš„çŸ¥è¯†ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°äº†åŠŸèƒ½å¼ºå¤§çš„ OpenCV Libã€‚">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="åŸºäº OpenCV çš„ iOS å®¢æˆ·ç«¯ç­”é¢˜å¡è¯†åˆ«ç®—æ³•">
  <meta property="og:description" content="æœ€è¿‘è®¡åˆ’å­¦ä¹ ä¸€äº›å›¾åƒå¤„ç†æ–¹é¢çš„çŸ¥è¯†ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°äº†åŠŸèƒ½å¼ºå¤§çš„ OpenCV Libã€‚">
  
  <link rel="icon" type="image/png" href="/assets/images/favicon.png" />
  <link href="/assets/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2018/04/opencv-answer-sheet-identify/">
  <link rel="alternate" type="application/rss+xml" title="å´”é¹é£" href="http://localhost:4000/feed.xml">


  <meta name="baidu-site-verification" content="Oia1IAYCuI" />

  
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="å‰å¾€ å´”é¹é£ çš„ä¸»é¡µ" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="å´”é¹é£ logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for å´”é¹é£" class="blog-button">å´”é¹é£</a></h1>

        
        <span class="panel-cover__subtitle panel-subtitle">Apple Dev</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">å—¨ï¼Œæˆ‘æ˜¯å´”é¹é£ï¼Œä¸€å iOS å¼€å‘å°å­¦ç”Ÿã€‚</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="è®¿é—®åšå®¢" class="blog-button">åšå®¢</a></li>
                
                  <li class="navigation__item"><a href="http://www.cuipengfei.cn/resumes/resumes2018.pdf" target="_blank" title="æˆ‘çš„ç®€å†">ç®€å†</a></li>
                
                  <li class="navigation__item"><a href="http://www.cuipengfei.cn/123.html" target="_blank" title="å¸¸ç”¨ç½‘å€å¯¼èˆª">å¯¼èˆª</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/githubError" title="@githubError çš„ Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  
  
  
  <!-- Twitter -->
  <li class="navigation__item">
    <a href="http://twitter.com/65518" title="@65518" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>
  

  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:0x00ffee@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-disabled"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2018-04-17 21:13:00 +0800" itemprop="datePublished" class="post-meta__date date">2018-04-17</time> &#8226; <span class="post-meta__tags tags">OpenCV</span>
    </div>
    <h1 class="post-title">åŸºäº OpenCV çš„ iOS å®¢æˆ·ç«¯ç­”é¢˜å¡è¯†åˆ«ç®—æ³•</h1>
  </header>

  <section class="post">
    <p>æœ€è¿‘è®¡åˆ’å­¦ä¹ ä¸€äº›å›¾åƒå¤„ç†æ–¹é¢çš„çŸ¥è¯†ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°äº†åŠŸèƒ½å¼ºå¤§çš„ OpenCV Libã€‚</p>

<p>æ—©åœ¨ä¸€å¹´å¤šå‰å‡ºæ¥åŒ—äº¬å®ä¹ çš„æ—¶å€™ï¼Œå®ä¹ å…¬å¸çš„ä¸€ä¸ªçŸ­è§†é¢‘å¤„ç† App åœ¨æœ€åˆçš„æŠ€æœ¯é€‰å‹çš„æ—¶å€™å°±å°† OpenCV ä½œä¸ºé‡è¦è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚æ— å¥ˆçš„æ˜¯ï¼Œå½“åˆæˆ‘æ˜¯ä¸€ä¸ªæ²¡æ¯•ä¸šçš„ iOS å°èœé¸¡ï¼Œåˆå‡ºèŒ…åºåˆä¸æ‡‚çš„ C++ï¼Œè¿˜è¦è‚©è´Ÿèµ·ç‹¬ç«‹å¼€å‘çš„å¤§æ——ï¼Œå®åœ¨æ˜¯æä¸æ‡‚ä¹Ÿæ²¡æ—¶é—´æè¿™ä¹ˆé«˜ç²¾å°–çš„ Libã€‚åœ¨æ”¾å¼ƒ OpenCV Lib ä»¥åŠå°è¯•è¿‡ AVFoundation æ¡†æ¶åï¼Œå› æ­¤é¡¹ç›®æœ€ç»ˆé€‰ç”¨äº† GPUImage æ¥å®ç°ï¼Œå½“ç„¶è¿™éƒ½æ˜¯åè¯äº†ã€‚</p>

<p>è¿™æ¬¡çš„ OpenCV çš„å­¦ä¹ ï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†å¼¥è¡¥ä¹‹å‰çš„æŠ€æœ¯ç©ºç™½ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯ä¸ºäº†è‡ªå·±èƒ½åœ¨å›¾åƒå¤„ç†ä¸Šæœ‰æ‰€äº†è§£ï¼Œèƒ½ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šæå‡ä¸€ä¸‹è‡ªèº«æŠ€æœ¯çš„ç»´åº¦ã€‚</p>

<h3 id="ç›®çš„åŠç»“æœ">ç›®çš„åŠç»“æœ</h3>
<p>æœ¬ç¯‡çš„å†™ä½œç›®çš„æ˜¯è®°å½•å­¦ä¹  OpenCV Lib ä»¥åŠè¿ç”¨åˆ°ç­”é¢˜å¡è¯†åˆ«çš„ç›¸å…³è¿‡ç¨‹ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯å¯¹æ–°å­¦ä¹ çŸ¥è¯†ç‚¹çš„æ¢³ç†å’Œé‡æ–°ç»„ç»‡ã€‚</p>

<p>æœ¬æ–‡çš„å®ç°ç›®çš„æ˜¯ï¼šåˆ©ç”¨ OpenCV Lib è¯†åˆ«ä¸€å¼ ç‰¹å®šçš„ç­”é¢˜å¡ç…§ç‰‡ï¼Œå¹¶ä¸”è¯†åˆ«å‡ºå­¦ç”Ÿå¡«æ¶‚çš„é€‰é¡¹ã€‚</p>

<h4 id="åŸå›¾å¦‚ä¸‹">åŸå›¾å¦‚ä¸‹ï¼š</h4>

<p><img src="http://www.cuipengfei.cn/assets/post_images/2018/opencv_origin.jpg" width="40%" /></p>

<h4 id="å®ç°ç»“æœå¦‚ä¸‹çº¢æ¡†å†…ä¸ºè¯†åˆ«ç»“æœ">å®ç°ç»“æœå¦‚ä¸‹ï¼šï¼ˆçº¢æ¡†å†…ä¸ºè¯†åˆ«ç»“æœï¼‰</h4>
<p><img src="http://www.cuipengfei.cn/assets/post_images/2018/opencv_result.png" width="40%" /></p>

<h3 id="å‡†å¤‡">å‡†å¤‡</h3>
<p>è€ƒè™‘åˆ° OpenCV æ˜¯åŸºäº C/C++ å¯è·¨å¹³å°çš„é€šç”¨ Libï¼Œä¸ºäº†é™ä½å­¦ä¹ æˆæœ¬ï¼Œä¾¿å°†æ•´ä¸ªå­¦ä¹ å’Œå®éªŒé›†æˆåˆ° iOS çš„å¼€å‘ç¯å¢ƒé‡Œäº†ã€‚å‰æœŸè¦åšå¦‚ä¸‹å‡ æ–¹é¢çš„å‡†å¤‡å·¥ä½œï¼š</p>

<ol>
  <li>ä¸‹è½½ç¼–è¯‘ OpenCV Libï¼Œæˆ–è€…ç›´æ¥ä¸‹è½½æœ€æ–°çš„ iOS OpenCV.framework çš„ Release ç‰ˆæœ¬ï¼›</li>
  <li>å°†è‡ªè¡Œç¼–è¯‘æˆ– Release ç‰ˆ OpenCV.framework å¯¼å…¥ iOS é¡¹ç›®å·¥ç¨‹ä¸­ï¼›</li>
  <li>å› ä¸º OpenCV ä¸­çš„ MIN å®å’Œ UIKit çš„ MIN å®æœ‰å†²çªï¼Œæ‰€ä»¥éœ€è¦åœ¨ .pch æ–‡ä»¶ä¸­ï¼Œå…ˆå®šä¹‰ OpenCV çš„å¤´æ–‡ä»¶ï¼Œå¦åˆ™ä¼šæœ‰ç¼–è¯‘é”™è¯¯ï¼›</li>
  <li>å°†éœ€è¦æ··ç¼– C++ å’Œ Objective-C çš„æ–‡ä»¶åç¼€æ”¹ä¸º <strong>.mm</strong>;</li>
  <li>ä¸º UIImage æ·»åŠ  Categoryï¼Œæ–¹ä¾¿ä¸OpenCV å›¾è±¡æ ¼å¼çš„æ•°æ® cv::Mat ç›¸äº’è½¬æ¢ã€‚
å› è¿™äº›ç¹ççš„é…ç½®é—®é¢˜ä¸æ˜¯æœ¬æ–‡å†™ä½œé‡ç‚¹ï¼Œè€Œä¸”ç½‘ä¸Šä¸ä¹ä¸€äº›è¯¦ç»†è¯´æ˜ï¼Œæ¨èå‚è€ƒ <a href="https://blog.devtang.com/2012/10/27/use-opencv-in-ios/">åœ¨MacOSå’ŒiOSç³»ç»Ÿä¸­ä½¿ç”¨OpenCV</a> ä¸€æ–‡ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚</li>
</ol>

<h3 id="æŠ€æœ¯æ–¹æ¡ˆ">æŠ€æœ¯æ–¹æ¡ˆ</h3>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨å­¦ä¹  OpenCV çš„åŸºç¡€çŸ¥è¯†æ—¶ï¼Œæ— æ„é—´å‘ç°å”å·§å¤§ç¥å‡ å¹´å‰å†™çš„ <a href="http://blog.devtang.com/2013/10/19/the-tech-detail-of-ape-client-2/">çŒ¿é¢˜åº“iOSå®¢æˆ·ç«¯çš„æŠ€æœ¯ç»†èŠ‚ï¼ˆäºŒï¼‰ï¼šç­”é¢˜å¡æ‰«æç®—æ³•</a> ä¸€æ–‡ã€‚æ–‡ä¸­æåˆ°ï¼Œåœ¨æ–‡ç« å‘å¸ƒæ—¶ç›¸å…³çš„è¯†åˆ«ç®—æ³•è¿˜åœ¨è¿›è¡Œä¸“åˆ©ç”³è¯·ï¼Œå¹¶ä¸”åœ¨ä¸“åˆ©ç”³è¯·ç»“æŸä¼šæŠ«éœ²ç®—æ³•ç»†èŠ‚ï¼Œä½†æ˜¯é—æ†¾çš„æ˜¯ç›¸å…³çš„ç®—æ³•ç»†èŠ‚å¹¶æ²¡æœ‰å…¬å¼€ã€‚</p>

<p>ä¸è¿‡ä¸‡å¹¸çš„æ˜¯ï¼Œå”å·§å¤§ç¥æä¾›äº†ä¸€å¥—ä¸é”™çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘æœ¬äººçš„ç®—æ³•å°±æ˜¯æŒ‰ç…§è¿™ä¸ªæ€è·¯å±•å¼€çš„ï¼Œæ–¹æ¡ˆå¦‚ä¸‹ï¼š</p>

<ul>
  <li>å›¾åƒé¢„å¤„ç†ï¼Œå‹ç¼©å›¾åƒï¼›</li>
  <li>å°†å½©è‰²å›¾åƒè½¬ä¸ºç°åº¦å›¾åƒï¼›</li>
  <li>äºŒå€¼åŒ–ç°åº¦å›¾åƒï¼Œè¯†åˆ«ç­”é¢˜å¡åŒºåŸŸï¼›</li>
  <li>é€è§†å˜æ¢ï¼Œå›¾åƒçº åï¼›</li>
  <li>ç­”æ¡ˆåŒºåŸŸ ROI è¯†åˆ«ï¼›</li>
  <li>ROI è‰²å€¼ç»Ÿè®¡ï¼Œæ ‡å®šç­”æ¡ˆã€‚</li>
</ul>

<h3 id="å…·ä½“å®ç°">å…·ä½“å®ç°</h3>
<p>ä»¥ä¸‹ä¸ºæ•´ä¸ªæŠ€æœ¯æ–¹æ¡ˆçš„åˆ†æ­¥å®ç°ç®—æ³•åŠæ•ˆæœå›¾ï¼Œç»å¤§éƒ¨åˆ†å‡ä½¿ç”¨çš„æ˜¯ OpenCV Lib æ ‡å‡† APIï¼Œå…·ä½“åŠŸèƒ½ä»¥åŠå‚æ•°è¯´æ˜å¯è‡ªè¡ŒæŸ¥é˜…<a href="https://opencv.org/">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>

<ul>
  <li>å›¾åƒé¢„å¤„ç†ã€å‹ç¼©å›¾åƒ</li>
</ul>

<p>å›  iOS ç³»ç»Ÿçš„å›¾ç‰‡æ•°æ®ä¸º UIImage ç±»å‹ï¼Œåœ¨ä½¿ç”¨ OpenCV Lib å¤„ç†å›¾ç‰‡æ˜¯éœ€è¦é¢„å¤„ç†æˆä¸º cv::Mat ç±»å‹ï¼Œç„¶åå°†é¢„å¤„ç†åçš„ cv::Mat å›¾åƒæ•°æ®ä½œä¸º inputMat å¹¶å¯¹å…¶è¿›è¡Œå‹ç¼©å¤„ç†ï¼Œé™ä½ CPU è¿ç®—è´Ÿè·ã€‚</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// å‹ç¼©</span>
<span class="n">cv</span><span class="o">::</span><span class="n">resize</span><span class="p">(</span><span class="n">inputMat</span><span class="p">,</span> <span class="n">outputMat</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="n">inputMat</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">inputMat</span><span class="p">.</span><span class="n">cols</span><span class="o">/</span> <span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="p">));</span>

</code></pre></div></div>

<p><br /></p>

<ul>
  <li>å°†å½©è‰²å›¾åƒè½¬ä¸ºç°åº¦å›¾åƒ</li>
</ul>

<p>å°†å‹ç¼©å¤„ç†åçš„ cv::Mat å½©è‰²å›¾åƒæ•°æ®è¿›è¡Œç°åº¦å¤„ç†ï¼Œä¾¿äºæ¥ä¸‹æ¥çš„äºŒå€¼åŒ–ã€‚</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ç°åº¦å¤„ç†</span>
<span class="n">cv</span><span class="o">::</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">inputMat</span><span class="p">,</span> <span class="n">outputMat</span><span class="p">,</span> <span class="n">CV_BGR2GRAY</span><span class="p">);</span>
</code></pre></div></div>
<p>å¤„ç†ç»“æœï¼š</p>

<p><img src="http://www.cuipengfei.cn/assets/post_images/2018/opencv_grayMat.png" width="40%" /></p>

<p><br /></p>

<ul>
  <li>å›¾åƒé™å™ªã€äºŒå€¼åŒ–</li>
</ul>

<p>åœ¨å›¾åƒè¿›è¡ŒäºŒå€¼åŒ–ä¹‹å‰ï¼Œéœ€è¦å¯¹ç°åº¦å›¾åƒåšä¸€æ¬¡é™å™ªå¤„ç†ï¼Œç”¨ä»¥æ¶ˆé™¤å›¾åƒæ¨¡ç³Šçš„å™ªå£°ï¼Œæé«˜äºŒå€¼åŒ–çš„æ¸…æ™°åº¦ã€‚åœ¨å¯¹æ¯”è¿‡å‡å€¼æ»¤æ³¢ã€é«˜æ–¯æ»¤æ³¢ã€ä¸­å€¼æ»¤æ³¢åï¼Œé€‰æ‹©äº†æ•ˆæœç¨æ˜æ˜¾çš„å‡å€¼æ»¤æ³¢æ–¹å¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// æ»¤æ³¢ å»å™ªå£°</span>
<span class="n">cv</span><span class="o">::</span><span class="n">blur</span><span class="p">(</span><span class="n">inputMat</span><span class="p">,</span> <span class="n">outputMat</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">));</span>

<span class="c1">// äºŒå€¼åŒ–</span>
<span class="n">cv</span><span class="o">::</span><span class="n">threshold</span><span class="p">(</span><span class="n">inputMat</span><span class="p">,</span> <span class="n">outputMat</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">THRESH_BINARY_INV</span><span class="p">);</span>
</code></pre></div></div>

<p>å¤„ç†ç»“æœï¼š</p>

<p><img src="http://www.cuipengfei.cn/assets/post_images/2018/opencv_binary.png" width="40%" /></p>

<p><br /></p>

<ul>
  <li>ç›´çº¿æ£€æµ‹</li>
</ul>

<p>å¯¹äºŒå€¼åŒ–å›¾åƒè¿›è¡Œç›´çº¿æ£€æµ‹ï¼Œç›®çš„æ˜¯æ£€æµ‹å‡ºç­”é¢˜å¡çš„æ–¹æ¡†ï¼Œä¸ºäº†è§†è§‰æ•ˆæœæ›´åŠ æ˜æ˜¾ï¼Œè¿™é‡Œå°†æ£€æµ‹çš„ç›´çº¿ï¼Œç›´æ¥ç»˜åˆ¶åœ¨å‹ç¼©çš„å›¾åƒä¸Šï¼Œå¹¶ä¸”é¢œè‰²è®¾ç½®ä¸ºçº¢è‰²ã€‚</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ç›´çº¿æ£€æµ‹</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec4i</span><span class="o">&gt;</span> <span class="n">lines</span><span class="p">;</span>
<span class="n">cv</span><span class="o">::</span><span class="n">HoughLinesP</span><span class="p">(</span><span class="n">outputMat</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">CV_PI</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span> <span class="n">resizeMat</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="n">resizeMat</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lines</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	
	 <span class="c1">// è·å–ç›´çº¿æ”¶å°¾ä¸¤ç‚¹</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Vec4i</span> <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="nf">i</span><span class="p">];</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Point</span> <span class="n">point_1</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Point</span> <span class="n">point_2</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
    
    <span class="c1">// ç»˜åˆ¶ç›´çº¿</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">line</span><span class="p">(</span><span class="n">resizeMat</span><span class="p">,</span> <span class="n">point_1</span><span class="p">,</span> <span class="n">point_2</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
<span class="p">}</span>
    
</code></pre></div></div>

<p>å¤„ç†ç»“æœï¼š</p>

<p><img src="http://www.cuipengfei.cn/assets/post_images/2018/opencv_line.png" width="40%" /></p>

<p><br /></p>

<ul>
  <li>ç›´çº¿è¿‡æ»¤</li>
</ul>

<p>å› éœ€è¦è¯†åˆ«ç­”é¢˜å¡çš„ROIåŒºåŸŸï¼ˆå³æ¯ä¸€é“é¢˜çš„é€‰é¡¹ä½ç½®ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¯†åˆ«å‡ºç­”é¢˜å¡æ–¹æ¡†åŒºåŸŸçš„å››ä¸ªé¡¶ç‚¹ï¼Œä»¥ä¾¿æ ¹æ®å››ä¸ªé¡¶ç‚¹è¿›è¡Œé€è§†å˜æ¢ã€‚</p>

<p>å››ä¸ªé¡¶ç‚¹çš„ä½ç½®å¯ä»¥æ ¹æ®ä¸Šã€ä¸‹ã€å·¦ã€å³å››æ¡ç›´çº¿ï¼Œä¸¤ä¸¤ç›¸äº¤çš„æ€§è´¨åˆ†åˆ«æ±‚å‡ºï¼Œä½†æ˜¯å¾ˆä¸å¹¸ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿›è¡Œç›´çº¿æ£€æµ‹æ—¶é€šè¿‡è®¾ç½®åˆç†çš„é˜ˆå€¼å‚æ•°ï¼Œèƒ½æ£€æµ‹å¤„åœ¨å‡ºè¾¹æ¡†èŒƒå›´å†…çš„å¾ˆå¤šæ¡ç›´çº¿ï¼Œå› æ­¤åœ¨è®¡ç®—å››ä¸ªäº¤ç‚¹ä¹‹å‰ï¼Œè¿˜éœ€è¦å…ˆåˆç†çš„è¿‡æ»¤å‡ºä¸Šã€ä¸‹ã€å·¦ã€å³å››æ¡ç›´çº¿ã€‚</p>

<p>ä¸ºæ–¹ä¾¿èµ·è§ï¼Œè¿™é‡Œç›´æ¥åœ¨æ£€æµ‹å‡ºç›´çº¿çš„æ—¶å€™è¿›è¡Œè¿‡æ»¤ï¼Œè¿‡æ»¤çš„è§„åˆ™å¾ˆç®€å•ï¼Œæ ¹æ®ç›´çº¿ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«ç›¸å¯¹äºå›¾åƒä¸­å¿ƒç‚¹çš„ä½ç½®ï¼Œåˆ¤æ–­å‡ºå½“å‰ç›´çº¿å±äºä¸Šä¸‹å·¦å³çš„å“ªä¸€ä¸ªæ–¹ä½ï¼Œå¹¶ä¸”åªä¿ç•™è¯¥æ–¹ä½ç¬¬ä¸€æ¡è¢«æ£€æµ‹åˆ°çš„ç›´çº¿ã€‚</p>

<p>ç›´çº¿æ£€æµ‹åŠè¿‡æ»¤çš„ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// ç›´çº¿æ£€æµ‹</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec4i</span><span class="o">&gt;</span> <span class="n">lines</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">HoughLinesP</span><span class="p">(</span><span class="n">outputMat</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">CV_PI</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span> <span class="n">resizeMat</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="n">resizeMat</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    
    <span class="n">cv</span><span class="o">::</span><span class="n">Vec4i</span> <span class="n">filtLines</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>   <span class="c1">// è¿‡æ»¤çš„çº¿ [ä¸Šï¼Œå·¦ï¼Œä¸‹ï¼Œå³]</span>
    <span class="kt">int</span> <span class="n">filtLineFlag</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    
    <span class="n">cv</span><span class="o">::</span><span class="n">Point</span> <span class="n">originPoint</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">resizeMat</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">resizeMat</span><span class="p">.</span><span class="n">cols</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// å›¾åƒä¸­å¿ƒç‚¹</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lines</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">Vec4i</span> <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="nf">i</span><span class="p">];</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">Point</span> <span class="n">point_1</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">Point</span> <span class="n">point_2</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
        
        <span class="c1">// è¿‡æ»¤çº¿</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">point_1</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">originPoint</span><span class="p">.</span><span class="n">y</span> <span class="o">&amp;&amp;</span> <span class="n">point_2</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">originPoint</span><span class="p">.</span><span class="n">y</span> <span class="o">&amp;&amp;</span> <span class="n">filtLineFlag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">filtLines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">;</span>
            <span class="n">filtLineFlag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">cv</span><span class="o">::</span><span class="n">line</span><span class="p">(</span><span class="n">resizeMat</span><span class="p">,</span> <span class="n">point_1</span><span class="p">,</span> <span class="n">point_2</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">point_1</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">originPoint</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">point_2</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">originPoint</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">filtLineFlag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">filtLines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">;</span>
            <span class="n">filtLineFlag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">cv</span><span class="o">::</span><span class="n">line</span><span class="p">(</span><span class="n">resizeMat</span><span class="p">,</span> <span class="n">point_1</span><span class="p">,</span> <span class="n">point_2</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">point_1</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">originPoint</span><span class="p">.</span><span class="n">y</span> <span class="o">&amp;&amp;</span> <span class="n">point_2</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">originPoint</span><span class="p">.</span><span class="n">y</span> <span class="o">&amp;&amp;</span> <span class="n">filtLineFlag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">filtLines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">;</span>
            <span class="n">filtLineFlag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">cv</span><span class="o">::</span><span class="n">line</span><span class="p">(</span><span class="n">resizeMat</span><span class="p">,</span> <span class="n">point_1</span><span class="p">,</span> <span class="n">point_2</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">point_1</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">originPoint</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">point_2</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">originPoint</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">filtLineFlag</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">filtLines</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">;</span>
            <span class="n">filtLineFlag</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">cv</span><span class="o">::</span><span class="n">line</span><span class="p">(</span><span class="n">resizeMat</span><span class="p">,</span> <span class="n">point_1</span><span class="p">,</span> <span class="n">point_2</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">line</span><span class="p">(</span><span class="n">resizeMat</span><span class="p">,</span> <span class="n">point_1</span><span class="p">,</span> <span class="n">point_2</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
    <span class="p">}</span>

</code></pre></div></div>

<p><br /></p>

<ul>
  <li>è®¡ç®—å››ä¸ªé¡¶ç‚¹</li>
</ul>

<p>ä¸Šé¢é€šè¿‡ç®€å•çš„è¿‡æ»¤ç®—æ³•ï¼Œå¾—åˆ°äº†ä¸åŒæ–¹ä½çš„å››æ¡ç›´çº¿ï¼Œå¹¶å­˜æ”¾åœ¨ cv::Vec4i filtLines[4] çš„å®¹å™¨å†…ï¼Œå®¹å™¨å†…çš„çº¿æ¡å’Œå¯¹åº”æ–¹ä½ä¸ºï¼š[ä¸Šï¼Œå·¦ï¼Œä¸‹ï¼Œå³]ã€‚</p>

<p>æ¥ä¸‹æ¥å˜å¯ä»¥åˆ†åˆ«å–å‡ºå¯¹åº”ä½ç½®çš„ä¸¤æ¡çº¿æ®µè®¡ç®—äº¤ç‚¹ï¼Œè®¡ç®—äº¤ç‚¹éœ€è¦ä½¿ç”¨ç®€å•çš„æ•°å­¦å…¬å¼ï¼Œä»£ç å¦‚ä¸‹ï¼Œä¸å†èµ˜è¿°ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// è®¡ç®—ç›´çº¿äº¤ç‚¹</span>
<span class="n">cv</span><span class="o">::</span><span class="n">Point</span> <span class="n">CrossPointWithLine</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec4i</span> <span class="o">&amp;</span> <span class="n">line1</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Vec4i</span> <span class="o">&amp;</span> <span class="n">line2</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="kt">int</span> <span class="n">l1_1_x</span> <span class="o">=</span> <span class="n">line1</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">l1_1_y</span> <span class="o">=</span> <span class="n">line1</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">l1_2_x</span> <span class="o">=</span> <span class="n">line1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">l1_2_y</span> <span class="o">=</span> <span class="n">line1</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    
    <span class="kt">float</span> <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">l1_1_y</span> <span class="o">-</span> <span class="n">l1_2_y</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">l1_1_x</span> <span class="o">-</span> <span class="n">l1_2_x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">?</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="p">:(</span><span class="n">l1_1_x</span> <span class="o">-</span> <span class="n">l1_2_x</span><span class="p">));</span>
    <span class="kt">float</span> <span class="n">b</span> <span class="o">=</span> <span class="n">l1_1_y</span> <span class="o">-</span> <span class="n">l1_1_x</span> <span class="o">*</span> <span class="n">a</span><span class="p">;</span>
    
    <span class="kt">int</span> <span class="n">l2_1_x</span> <span class="o">=</span> <span class="n">line2</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">l2_1_y</span> <span class="o">=</span> <span class="n">line2</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">l2_2_x</span> <span class="o">=</span> <span class="n">line2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">l2_2_y</span> <span class="o">=</span> <span class="n">line2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    
    <span class="kt">float</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">l2_1_y</span> <span class="o">-</span> <span class="n">l2_2_y</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">l2_1_x</span> <span class="o">-</span> <span class="n">l2_2_x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">?</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="p">:</span> <span class="p">(</span><span class="n">l2_1_x</span> <span class="o">-</span> <span class="n">l2_2_x</span><span class="p">));</span>
    <span class="kt">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">l2_1_y</span> <span class="o">-</span> <span class="n">l2_1_x</span> <span class="o">*</span> <span class="n">c</span><span class="p">;</span>
    
    <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">c</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">d</span> <span class="o">-</span> <span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">c</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ä½¿ç”¨å®¹å™¨å°†è®¡ç®—çš„äº¤ç‚¹ï¼ŒæŒ‰ç…§ä½ç½®æœ‰åºå­˜å‚¨ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">filtPoints</span><span class="p">;</span> <span class="c1">// å­˜æ”¾è®¡ç®—çš„ç„¦ç‚¹</span>

<span class="n">filtPoints</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">CrossPointWithLine</span><span class="p">(</span><span class="n">filtLines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filtLines</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
    <span class="n">filtPoints</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">CrossPointWithLine</span><span class="p">(</span><span class="n">filtLines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filtLines</span><span class="p">[</span><span class="mi">3</span><span class="p">]));</span>
    <span class="n">filtPoints</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">CrossPointWithLine</span><span class="p">(</span><span class="n">filtLines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">filtLines</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
    <span class="n">filtPoints</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">CrossPointWithLine</span><span class="p">(</span><span class="n">filtLines</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">filtLines</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
    
</code></pre></div></div>

<p>å·²è®¡ç®—çš„å››ä¸ªäº¤ç‚¹ä¸ºåœ†å¿ƒç”»åœ†ï¼ŒæŸ¥çœ‹æ•ˆæœï¼ˆå››ä¸ªé¡¶ç‚¹çš„åœ†ç”»çš„æœ‰ç‚¹å°ï¼Œå‡‘åˆçœ‹å§ğŸ˜‚ï¼‰ï¼š</p>

<p><img src="http://www.cuipengfei.cn/assets/post_images/2018/opencv_crossPoint.png" width="40%" /></p>

<p><br /></p>

<ul>
  <li>å›¾åƒçº å</li>
</ul>

<p>æ ¹æ®ä¸Šè¿°çš„å››ä¸ªé¡¶ç‚¹ï¼Œæ„é€ é€è§†å˜æ¢çš„å˜æ¢çŸ©é˜µï¼Œåˆ©ç”¨ OpenCV Lib çš„é€è§†å˜æ¢ï¼Œå¯¹ç°åº¦å›¾åƒï¼Œè¿›è¡Œå›¾åƒçº åå¤„ç†ã€‚</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="c1">// æ„é€ å˜æ¢çŸ©é˜µ</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span> <span class="n">src_vertices</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">src_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">src_vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtPoints</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">src_vertices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtPoints</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="n">src_vertices</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtPoints</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    
    <span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span> <span class="n">dst_vertices</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">dst_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">resizeMat</span><span class="p">.</span><span class="n">cols</span><span class="p">);</span>
    <span class="n">dst_vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">resizeMat</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span><span class="n">resizeMat</span><span class="p">.</span><span class="n">cols</span><span class="p">);</span>
    <span class="n">dst_vertices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">dst_vertices</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">resizeMat</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    
    <span class="c1">// é€è§†å˜æ¢</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">getPerspectiveTransform</span><span class="p">(</span><span class="n">src_vertices</span><span class="p">,</span><span class="n">dst_vertices</span><span class="p">);</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">grayMat</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="n">resizeMat</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">resizeMat</span><span class="p">.</span><span class="n">cols</span><span class="p">));</span>
</code></pre></div></div>

<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="http://www.cuipengfei.cn/assets/post_images/2018/opencv_transform.png" width="40%" /></p>

<p><br /></p>

<ul>
  <li>è®¾ç½®é€‰é¡¹åŒºåŸŸ ROIï¼ˆæ„Ÿå…´è¶£åŒºåŸŸï¼‰</li>
</ul>

<p>è§‚å¯Ÿçº ååçš„ç°åº¦å›¾åƒçš„è§„å¾‹ï¼Œå¯ä»¥æŒ‰ç…§æ¯5é“é¢˜è®¾ç½®ä¸€ä¸ª ROIï¼Œå¹¶æ ‡å®šå‡ºç›¸åº”çš„ä½ç½®ï¼Œè¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œä¸Šä¸‹å·¦å³ä»¥åŠ ROI é—´éš”çš„è®¾ç½®éœ€è¦æ ¹æ®æ•´ä¸ªçº ååçš„å›¾åƒå¤§å°çš„æ¯”ä¾‹æ¥ç¡®å®šï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™é‡Œç›´æ¥å†™æˆå›ºå®šå€¼ã€‚ç®—æ³•å¦‚ä¸‹ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// è®¾ç½®ROI, ä½¿ç”¨å®¹å™¨è®°å½•ROI</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Rect</span><span class="o">&gt;</span> <span class="n">ROIRect</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">leading</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">trailing</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">margin_col</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">margin_row</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">grayMat</span><span class="p">.</span><span class="n">cols</span> <span class="o">-</span> <span class="n">leading</span> <span class="o">-</span> <span class="n">trailing</span> <span class="o">-</span> <span class="n">margin_col</span> <span class="o">*</span> <span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">col</span><span class="p">;</span>
    <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">grayMat</span><span class="p">.</span><span class="n">rows</span> <span class="o">-</span> <span class="n">top</span> <span class="o">-</span> <span class="n">bottom</span> <span class="o">-</span> <span class="n">margin_row</span> <span class="o">*</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">row</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">row</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">col</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cv</span><span class="o">::</span><span class="n">Rect</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Rect</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="n">margin_col</span><span class="p">)</span> <span class="o">+</span> <span class="n">leading</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="n">margin_row</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="n">top</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
            <span class="n">ROIRect</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">rect</span><span class="p">);</span>
            
            <span class="n">cv</span><span class="o">::</span><span class="n">rectangle</span><span class="p">(</span><span class="n">writeMat</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>å°†åˆ’åˆ†çš„ ROI ä½¿ç”¨æ–¹æ¡†æ ‡è®°ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="http://www.cuipengfei.cn/assets/post_images/2018/opencv_ROIRect.png" width="40%" /></p>

<p><br /></p>

<ul>
  <li>æ ¹æ®é€‰é¡¹åŒºåŸŸï¼Œè®¾ç½®æ¯é“é¢˜çš„ ROI</li>
</ul>

<p>è¿™ä¸€æ­¥å¯¹é€‰é¡¹åŒºåŸŸè¿›ä¸€æ­¥æ‹†åˆ†ï¼Œè®¡ç®—å‡ºæ¯ä¸€é“é¢˜çš„ ROIã€‚å¯ä»¥å’Œä¸Šé¢è®¡ç®—åŒºåŸŸçš„æ–¹æ³•åˆå¹¶ï¼Œç›´æ¥è¿›è¡Œæ¯é“é¢˜çš„ ROI æ‹†åˆ†ï¼Œèƒ½æœ‰æ•ˆå‡å°‘å¾ªç¯åŠè®¡ç®—æ¬¡æ•°ï¼Œé™ä½ CPU è´Ÿè·ï¼Œè¿™å¤§æ¦‚ä¹Ÿæ˜¯æœ€åè¯†åˆ«è€—æ—¶æ¯”å”å·§å¤§ä½¬å¤šå‡º0.03ç§’çš„åŸå› ä¹‹ä¸€ï¼Œè¿™é‡Œä¸å†æ·±ç©¶ã€‚</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// éå†ROIï¼Œè®¾ç½®å¹¶è®°å½•æ¯é“é¢˜çš„ROI</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Rect</span><span class="o">&gt;</span> <span class="n">ROIItemRect</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ROIRect</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">Rect</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">ROIRect</span><span class="p">[</span><span class="nf">i</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">margin_height</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">margin_height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cv</span><span class="o">::</span><span class="n">Rect</span> <span class="n">itemRect</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Rect</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="n">margin_height</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
            <span class="n">ROIItemRect</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">itemRect</span><span class="p">);</span>
            
            <span class="n">cv</span><span class="o">::</span><span class="n">rectangle</span><span class="p">(</span><span class="n">writeMat</span><span class="p">,</span> <span class="n">itemRect</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="http://www.cuipengfei.cn/assets/post_images/2018/opencv_ROIItemRect.png" width="40%" /></p>

<p><br /></p>

<ul>
  <li>äºŒå€¼åŒ–çº ååçš„ç°åº¦å›¾åƒï¼Œä¾¿äºæ¥ä¸‹æ¥çš„è‰²å€¼ç»Ÿè®¡</li>
</ul>

<p>è¿™é‡Œå¯¹çº ååçš„ç°åº¦å›¾è¿›è¡ŒäºŒå€¼åŒ–æ“ä½œï¼Œå…¶å®ä¸æ˜¯å¿…é¡»çš„ï¼Œä¸ºäº†æ€§èƒ½æå‡å‡å°‘è€—æ—¶æ‰åšï¼Œåœ¨è¿›è¡Œä¸Šé¢çš„å›¾åƒçº åæ—¶å¯ä»¥ç›´æ¥å¯¹ç¬¬ä¸€æ¬¡äºŒå€¼åŒ–çš„å›¾åƒè¿›è¡Œçº åæ“ä½œã€‚ä½†æ˜¯åœ¨å®ç°çš„è¿‡ç¨‹ä¸­å› ä¸ºè¦æ§åˆ¶æ¯ä¸€æ­¥çš„æ˜¾ç¤ºæ•ˆæœï¼Œè¿™é‡Œå¤šåšäº†ä¸€æ¬¡å¤„ç†ï¼Œå¯ä»¥å¿½ç•¥ã€‚</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	 <span class="c1">// äºŒå€¼åŒ– ç°åº¦å›¾</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">binaryMat</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">threshold</span><span class="p">(</span><span class="n">grayMat</span><span class="p">,</span> <span class="n">binaryMat</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">THRESH_BINARY</span><span class="p">);</span>
</code></pre></div></div>

<p><br /></p>

<ul>
  <li>åˆ†å‰²é€‰é¡¹ï¼Œç»Ÿè®¡è‰²å€¼ï¼Œè®¡ç®—æœ‰æ•ˆä½œç­”</li>
</ul>

<p>å¯¹çº ååçš„äºŒå€¼åŒ–å›¾åƒï¼ŒæŒ‰ç…§ä¸Šè¿°è®¡ç®—çš„æ¯é“é¢˜çš„ ROIï¼ŒæŒ‰ç…§é€‰é¡¹æ¨ªå‘å‡ç­‰åˆ’åˆ†ä¸º 5 ä¸ªåŒºåŸŸï¼Œå¯¹åº”ç­”é¢˜å¡ä¸­çš„ ABCDE äº”ä¸ªé€‰é¡¹ï¼Œåˆ†åˆ«å¯¹æ¯é“é¢˜çš„ ROI çš„ 5 ä¸ªåŒºåŸŸçš„åƒç´ è¿›è¡Œè‰²å€¼ç»Ÿè®¡ï¼Œç»Ÿè®¡å‡ºè‰²å€¼ç­‰äº 0 çš„åƒç´ ç‚¹ä¸ªæ•°ï¼Œä¸ªæ•°è¶…è¿‡è¯¥é€‰é¡¹æ€»åƒç´ ç‚¹çš„ 25% æ—¶å³ä¸ºæœ‰æ•ˆä½œç­”ï¼Œå¹¶ä¸” log å‡ºå½“å‰çš„é¢˜å·å’Œé€‰é¡¹å€¼ã€‚ç®—æ³•å¦‚ä¸‹ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ROIItemRect</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// éå†æ¯é“é¢˜</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">Rect</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">ROIItemRect</span><span class="p">[</span><span class="nf">i</span><span class="p">];</span>
        <span class="c1">// åˆ†å‰²é€‰é¡¹</span>
        <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">rect</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">5</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cv</span><span class="o">::</span><span class="n">Rect</span> <span class="n">itemRect</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Rect</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span> <span class="o">*</span> <span class="n">k</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
            <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">roiMat</span> <span class="o">=</span> <span class="n">binaryMat</span><span class="p">(</span><span class="n">itemRect</span><span class="p">);</span>   <span class="c1">// æˆªå–ROI</span>
            
            <span class="n">cv</span><span class="o">::</span><span class="n">rectangle</span><span class="p">(</span><span class="n">writeMat</span><span class="p">,</span> <span class="n">itemRect</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
            
            <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// ç»Ÿè®¡è‰²å€¼</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">roiMat</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">roiMat</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    
                    <span class="k">if</span> <span class="p">(</span><span class="n">roiMat</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">count</span> <span class="o">++</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            
            <span class="c1">// è¶…è¿‡ 25% ç®—ä½œæœ‰æ•ˆç­”æ¡ˆ</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;</span> <span class="n">roiMat</span><span class="p">.</span><span class="n">rows</span> <span class="o">*</span> <span class="n">roiMat</span><span class="p">.</span><span class="n">cols</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">25</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">switch</span> <span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"ç¬¬ %d é¢˜ï¼šA"</span><span class="p">,</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"ç¬¬ %d é¢˜ï¼šB"</span><span class="p">,</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"ç¬¬ %d é¢˜ï¼šC"</span><span class="p">,</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"ç¬¬ %d é¢˜ï¼šD"</span><span class="p">,</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"ç¬¬ %d é¢˜ï¼šE"</span><span class="p">,</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                        
                    <span class="k">default</span><span class="o">:</span>
                        <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>æœ€ç»ˆçš„è¯†åˆ«ç»“æœå¦‚ä¸‹ï¼š</p>

<p><img src="http://www.cuipengfei.cn/assets/post_images/2018/opencv_result.png" width="40%" /></p>

<p><br /><br /></p>

<h3 id="æ€»ç»“">æ€»ç»“</h3>

<p>è¿™å¥—è§£å†³æ–¹æ¡ˆçš„å®ç°æ€è·¯æ¥æºäºå”å·§å¤§ç¥çš„<a href="http://blog.devtang.com/2013/10/19/the-tech-detail-of-ape-client-2/">çŒ¿é¢˜åº“iOSå®¢æˆ·ç«¯çš„æŠ€æœ¯ç»†èŠ‚ï¼ˆäºŒï¼‰ï¼šç­”é¢˜å¡æ‰«æç®—æ³•</a> ä¸€æ–‡ï¼Œæœ¬æ–‡å®ç°çš„ç®—æ³•æ²¡æœ‰ç»è¿‡è¿‡å¤šçš„æµ‹è¯•ï¼Œä»…èƒ½ä¿è¯è¿™å¼ å›¾ç‰‡çš„è¯†åˆ«ç‡åœ¨95%ä»¥ä¸Šã€‚å¦å¤–ï¼Œåœ¨ CPU è¿ç®—è€—æ—¶ä¸Šé¢ï¼Œè¿™äº›è®¡ç®—æ–¹å¼æ²¡æœ‰è¿›è¡Œä¼˜åŒ–ä¹Ÿä¸æ˜¯æœ€ä¼˜è§£ã€‚</p>

<p>å”å·§å¤§ç¥æ²¡æœ‰å¼€æºæ­¤ç®—æ³•ï¼Œæˆ‘è¿™èœé¸¡ä»£ç å¤§å®¶å‡‘åˆçœ‹å§ï¼Œæºä»£ç ä¸åŒ…å« opencv2.frameworkï¼Œè¯·è‡ªè¡Œä¸‹è½½åæ·»åŠ è¿›é¡¹ç›®ä¸­ã€‚ç­”é¢˜å¡è¯†åˆ« Demo åœ°å€ï¼š<a href="https://github.com/githubError/AnwserSheetIdentify">https://github.com/githubError/AnwserSheetIdentify</a></p>

<p>å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»æˆ‘ï¼š<a href="http://www.cuipengfei.cn/">http://www.cuipengfei.cn/</a></p>

<p>-EOF-</p>

  </section>
</article>

<section class="read-more">
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æ›´æ—©çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/09/memory-manage/" title="link to iOSçš„å†…å­˜ç®¡ç†">iOSçš„å†…å­˜ç®¡ç†</a></h2>
       <p class="excerpt">  ä¸€äº›æœ‰å…³iOSçš„å†…å­˜ç®¡ç†çš„è®¤è¯†è®°å½•1ã€copy å…³é”®å­—  copyå…³é”®å­—æœ‰ä»¥ä¸‹ä¸¤ç§ä½¿ç”¨æƒ…å†µ  å¯¹éé›†åˆç±»å¯¹è±¡çš„ copy æ“ä½œåŠ mutableCopy æ“ä½œ  å¯¹é›†åˆç±»å¯¹è±¡çš„ copyæ“ä½œåŠ mutableCopy æ“ä½œä¸‹é¢åˆ†åˆ«å¯¹è¿™ä¸¤ç§æƒ…å†µä¸¾ä¾‹è¯´æ˜ï¼š1ã€å¯¹éé›†åˆç±»å¯¹è±¡çš„ copy æ“ä½œåŠ mutableCopy æ“ä½œNSMutableString *mStr = [[NSMutableString alloc] initWithString:@"åŸå¯å˜å­—ç¬¦ä¸²"];NSString *...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-09-10 21:13:00 +0800" class="post-list__meta--date date">2017-09-10</time> &#8226; <span class="post-list__meta--tags tags">å†…å­˜ç®¡ç†</span><a class="btn-border-small" href=/2017/09/memory-manage/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
</section>

<section class="post-comments">
  
  
  
        <!-- UY BEGIN -->
        <div id="uyan_frame"></div>
        <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2128073">
            (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//v2.uyan.cc/code/uyan.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
            || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
        </script>
        <!-- UY END -->
        
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">æœ¬ç«™ç‚¹é‡‡ç”¨<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº« ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… è®¸å¯åè®®</a></span>
        <span class="footer__copyright">ç”± <a href="https://jekyllrb.com">Jekyll</a> äº 2018-04-27 ç”Ÿæˆï¼Œæœ¬ç«™ç”± <a href="https://github.com/githubError">@githubError</a> åˆ›å»ºï¼Œæ‚¨å¯ä»¥åœ¨ GitHub æ‰¾åˆ°<a href="https://github.com/githubError/">æœ¬ç«™æºç </a> - &copy; 2018</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>



<script type="text/javascript" src="/js/main.js"></script>


<!-- Global site tag (gtag.js) - Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117740493-1"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-117740493-1');

  </script>




<!-- Baidu analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?68ee30beb4d6d80c7b20fff177545e7d";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


    
  </body>

</html>
